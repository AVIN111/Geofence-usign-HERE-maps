<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <link rel="icon" href="https://avin111.github.io/Hello-World/favicon.jpeg" type="image" sizes="16x16">
</head>
<body style="margin: 0">
    <div id="map" style="width: 100vw; height: 100vh"></div>
    <script src="https://js.api.here.com/v3/3.1.22.0/mapsjs-core.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://js.api.here.com/v3/3.1.22.0/mapsjs-core-legacy.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://js.api.here.com/v3/3.1.22.0/mapsjs-service.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://js.api.here.com/v3/3.1.22.0/mapsjs-service-legacy.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://js.api.here.com/v3/3.1.22.0/mapsjs-mapevents.js" type="text/javascript" charset="utf-8"></script>
    <script src="https://stuk.github.io/jszip/dist/jszip.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <script>

            const platform = new H.service.Platform ({
                    'apikey' : 'fCu-HyXjN1q4AFNUHHm_9KK67SuGNeFqfY9-AP7v2Hk',
                    'useCIT': true,
                    'useHTTPS': true,
                });
                const map = new H.Map (
                    document.getElementById('map'),
                    platform.createDefaultLayers().vector.normal.map,
                    {
                        zoom: 15,
                        center: { lat: 27.961809, lng: 76.401522 },
                    }
            );

            const mapEvents = new H.mapevents.MapEvents(map);
            const mapBehavior = new H.mapevents.Behavior(mapEvents);



            //near by shop testing
            const jalpilu = new H.map.Circle({lat: 27.965868, lng: 76.402353}, 20);

            map.addObject(jalpilu);
        
            const ug2 = new H.map.Circle({lat: 27.960162, lng: 76.403924}, 30);
            map.addObject(ug2);

            const tpoint = new H.map.Circle({lat: 27.962827, lng: 76.402594}, 20); 
            map.addObject(tpoint);

            const nescafe = new H.map.Circle({lat: 27.960935, lng: 76.403179}, 25);
            map.addObject(nescafe);
            


            //console getting the wkt format data
            const geometry_ug2 = ug2.getGeometry();
            const wkt_ug2 = geometry_ug2.toString();
            console.log(wkt_ug2);


            const geometry_tpoint = tpoint.getGeometry();
            const wkt_tpoint = geometry_tpoint.toString();
            console.log(wkt_tpoint);

            const geometry_jalpilu = jalpilu.getGeometry();
            const wkt_jalpilu = geometry_jalpilu.toString();
            console.log(wkt_jalpilu);
        
            const geometry_nescafe = nescafe.getGeometry();
            const wkt_nescafe = geometry_nescafe.toString();
            console.log(wkt_nescafe);

    

            //zip file for shop
            const zip_shop = new JSZip();
            zip_shop.file("data_ug2.wkt","UG2\tWKT\n" + "Ug2p" + "\t" + wkt_ug2);
            zip_shop.generateAsync({ type: "blob" }).then(content => {
                var formData = new FormData();
                formData.append("zipfile", content);
                axios.post("https://fleet.ls.hereapi.com/2/layers/upload.json", formData, {
                    headers: {
                        "content-type": "multipart/form-data"
                    },
                    params: {
                        "apikey" : "fCu-HyXjN1q4AFNUHHm_9KK67SuGNeFqfY9-AP7v2Hk",
                        "layer_id": "1235"

                        }
                    }).then(result => {
                        console.log(result);
                    }, error => {
                        console.error(error);
                    });
                }, error => {
                    console.error(error);
            });

            //zip file for Road
            const zip_road = new JSZip();
            zip_road.file("data.wkt","TPOINT\tWKT\n" + "Tpoint" + "\t" + wkt_tpoint);
            zip_road.generateAsync({ type: "blob" }).then(content => {
                var formData = new FormData();
                formData.append("zipfile", content);
                axios.post("https://fleet.ls.hereapi.com/2/layers/upload.json", formData, {
                    headers: {
                        "content-type": "multipart/form-data"
                    },
                    params: {
                        "apikey" : "fCu-HyXjN1q4AFNUHHm_9KK67SuGNeFqfY9-AP7v2Hk",
                        "layer_id": "1236"

                        }
                    }).then(result => {
                        console.log(result);
                    }, error => {
                        console.error(error);
                    });
                }, error => {
                    console.error(error);
            });

            const zip_house = new JSZip();
            zip_house.file("data_jalpilu.wkt","JALPILU\tWKT\n" + "Jalpilu" + "\t" + wkt_jalpilu);
            zip_house.generateAsync({ type: "blob" }).then(content => {
                var formData = new FormData();
                formData.append("zipfile", content);
                axios.post("https://fleet.ls.hereapi.com/2/layers/upload.json", formData, {
                    headers: {
                        "content-type": "multipart/form-data"
                    },
                    params: {
                        "apikey" : "fCu-HyXjN1q4AFNUHHm_9KK67SuGNeFqfY9-AP7v2Hk",
                        "layer_id": "1237"

                        }
                    }).then(result => {
                        console.log(result);
                    }, error => {
                        console.error(error);
                    });
                }, error => {
                    console.error(error);
            });
        
            const zip_saloon = new JSZip();
            zip_saloon.file("data_nescafe.wkt","NESCAFE\tWKT\n" + "Nescafe" + "\t" + wkt_nescafe);
            zip_saloon.generateAsync({ type: "blob" }).then(content => {
                var formData = new FormData();
                formData.append("zipfile", content);
                axios.post("https://fleet.ls.hereapi.com/2/layers/upload.json", formData, {
                    headers: {
                        "content-type": "multipart/form-data"
                    },
                    params: {
                        "apikey" : "fCu-HyXjN1q4AFNUHHm_9KK67SuGNeFqfY9-AP7v2Hk",
                        "layer_id": "1238"

                        }
                    }).then(result => {
                        console.log(result);
                    }, error => {
                        console.error(error);
                    });
                }, error => {
                    console.error(error);
            });

            navigator.geolocation.watchPosition(({coords}) => {

                var lat = coords.latitude;
                var lon = coords.longitude;
                console.log(lat);
                console.log(lon);
                
                var marker = new H.map.Marker({ lat: coords.latitude, lng: coords.longitude});
                map.addObject(marker);


                var geofencing = platform.getGeofencingService();



                //click event on marker

                /*map.addEventListener("tap", ev => {
                    var target = ev.target;
                    map.removeObject(marker);   /// removing the older marker when new one arrives
                    marker = new H.map.Marker(map.screenToGeo(ev.currentPointer.viewportX, ev.currentPointer.viewportY));
                    map.addObject(marker);*/

                    //utilizing geofencing service
                geofencing.request(
                    H.service.extension.geofencing.Service.EntryPoint.SEARCH_PROXIMITY,
                    {
                        "layer_ids": ["1235", "1236", "1237", "1238"],
                        "proximity": lat + "," + lon,
                        "key_attributes": ["UG2", "TPOINT", "JALPILU", "NESCAFE"]
                    },result => {
                        if(result.geometries.length > 0) {
                            if(result.geometries[0].layerId == "1235") {
                                swal("Reached UG2 Boys Hostel!");
                                console.log(result);
                            }
                            else if(result.geometries[0].layerId == "1236"){
                                swal("Cross the Road Carefully!!");
                                console.log(result);
                            }
                            else if(result.geometries[0].layerId == "1237"){
                                swal("Reached JALPILU!!");
                                console.log(result);
                            }
                            else if(result.geometries[0].layerId == "1238"){
                                swal("Have a cup of COFFEE!!");
                                console.log(result);
                            }
                           
                        }
                    },
                    error => {
                        console.error(error);
                    }

                );

            });

    </script>
        
</body>
</html>

